(ns aoc.y2018.d13.bgrabow
  (:refer-clojure :exclude [read-string format])
  (:require
    [aoc.utils :as u :refer [deftest read-string format]]
    ;[aoc.y2018.d13.data :refer [input answer-1 answer-2]]
    [clojure.test :as t :refer [is testing]]
    [clojure.string :as str]
    [clojure.set :as set]))

(def my-input "/------------------------------------\\                   /----------------------------------------------------------------------------------\\         \n|                                    |                   |                                   /----------------------------------------------+\\        \n|                                    |                   |                                   |            /--------------\\                  ||        \n|                                    |             /-----+------------------\\                |            |              |                  ||        \n|              /---------------------+-------------+-----+------------------+------------\\   |            |              |                  ||        \n|              |                     |             |     |                  |            |   |/-----------+--------------+------------------++\\       \n|              |    /------------\\   |             |     |                  |            |   ||           |              |                  |||       \n| /------------+----+------------+---+-------------+----\\|                  |     /------+---++-----------+-------\\      |                  |||       \n| |            |    |      /-----+---+-------------+----++------------------+-----+------+---++-----------+-------+------+-------\\          |||       \n| |            |    |      |     |   |             |    ||                  |     |      |   ||   /-------+-------+------+--\\    |      /---+++---\\   \n| |            |    |      |     |   |             |    ||                  |     |     /+---++---+-------+--\\    |      |  |    |      |   |||   |   \n| |            |    |      |     |   |             |    ||   /--------------+-----+-----++---++---+-------+--+-\\  |      |  |    |      |   |||   |   \n| |/-----------+----+------+-----+---+-------------+----++---+----------\\   |     |     ||   ||   |       |  | |  |      |  |/---+------+---+++---+-\\ \n| ||          /+----+------+-----+---+-------------+----++---+----------+---+-----+-----++---++---+-------+--+-+-\\|      |  ||   |      |   |||   | ^ \n| ||          ||    |      |     |  /+-------------+----++---+----------+--\\|     |     ||   ||   |       |  | | ||/-----+--++---+------+-\\ |||   | | \n| ||          ||  /-+---->-+-----+--++-------------+----++---+----------+--++-----+-----++---++---+-------+--+-+-+++\\    |  ||   |      | | |||   | | \n| ||          ||  | |      |   /-+--++--\\          |    ||   |         /+--++-----+-----++\\  ||   |       |  | | ||||    |  ||   |      | | |||   | | \n| ||          ||  | |     /+---+-+--++--+----------+----++---+---------++--++-----+-----+++--++---+-------+--+-+-++++---\\|  ||   |      | | |||   | | \n| ||          ||  | |     || /-+-+--++--+----\\     |    ||   |         ||  ||     |     |||  \\+---+-------+--+-+-++++---++--++---+------+-+-+/|   | | \n| ||          ||  | |     |\\-+-+-+--++--+----+->---+----++---+---------++--++-----+-----+++---+---+-------+--+-+-++++---++--++---/      | | | |   | | \n| ||          ||  | |     |  | | |  ||  |    |     \\----++---+---------++--+/     |     |||   |   |       |  | | ||||   ||  ||          | | | |   | | \n| ||          ||  | |     |  | | |  ||  |  /-+----------++---+-\\       ||  |      |     |||   |   |       |  | | ||||   ||  ||          | | | |   | | \n| ||          ||  | |     |  | | |  ||  |  | |          ||   | |       || /+------+---\\ |||   |   |       |  | | ||||   ||  ||          | | | |   | | \n| ||          ||  | |     |  | | |  ||  |  | |          ||   | |       || ||      |   | |||   \\---+-------+--+-+-++++---++--++----------+-+-+-/   | | \n| ||          ||  | |     |  | | |/-++--+--+-+----------++\\  | |       || || /----+---+-+++-------+-------+--+-+-++++---++--++---------\\| | |     | | \n|/++----------++--+-+-----+--+-+-++-++--+--+-+----------+++--+-+-------++-++-+----+---+-+++-------+------\\|  | | ||||   ||  ||         || | |     | | \n||||          |\\--+-+-----+--+-+-++-++--+--+-+----------+++--+-+-------++-++-+----+---+-+/|       |      ||  | | ||||   ||  ||         || | |     | | \n||||          |   | |  /--+--+-+-++-++--+--+-+----------+++--+-+-------++-++-+----+---+-+-+-------+------++--+-+\\||||   ||  ||         || | |     | | \n||||   /------+---+-+--+--+--+-+-++-++--+--+-+----------+++--+-+-------++-++-+----+---+-+-+-\\     |      ||  | ||||||   ||  ||         || | |     | | \n||||   |      |   | |  |  |  | | ||/++--+--+-+----------+++--+-+\\ /----++-++-+----+---+-+-+-+-----+---\\  ||  | ||||||   ||  ||         || | |     | | \n||||   |      |   | |  |  |  | | |||||  |  |/+----------+++--+-++-+--\\ || || |    |   | | | |     |   |  |\\--+-++++++---+/  ||         || | |     | | \n||||   |      |   | |  |  |  | \\-+++++--/  |||          ||| /+-++-+--+-++-++-+----+---+-+-+-+-----+---+--+---+-++++++---+---++-\\       || | |     | | \n||||   |      |   | |  |  |  |   |||||     |||          ||| || || | /+-++-++-+----+---+-+-+-+\\    |   |  |   | ||||||   |   || |       || | |     | | \n||||   |      |   | |  |  |  |   |\\+++-----+++----------++/ || || | || || || \\----+---+-+-+-++----+---+--+---+-++++++---+---++-+-------/| | |     | | \n||||   |      |   | |  |  |  |   | |||     |||        /-++--++-++-+-++-++-++------+---+-+-+-++----+---+--+---+-++++++---+---++-+--\\     | | |     | | \n||||   |      |   | |  |  |  |   | |||/----+++--------+-++--++-++-+-++-++-++------+---+-+-+-++----+---+--+--\\| ||||||   |   || |  |     | | |     | | \n\\+++---+------+---+-+--+--+--+---+-++/|    |||        | ||  || ||/+-++-++-++------+---+-+-+-++----+---+-\\|  || ||||||   |   || |  |     | | |     | | \n ||| /-+------+---+-+--+--+--+---+-++-+----+++--\\     | ||  || |||| || || ||      |   | | | ||    |   | ||  || ||||||   |   || |  |     | | |     | | \n ||| v |      |   | |  |  |  |   | || |/---+++--+-\\   | ||  || |||| || || ||      |/--+-+-+-++----+---+-++--++-++++++---+---++-+--+-----+-+-+--\\  | | \n ||| | |   /--+---+-+--+--+--+---+-++-++---+++--+-+---+-++--++-++++-++-++-++------++--+-+-+-++----+---+-++--++-++++++--\\|   || |  |     | | |  |  | | \n ||| | |   |  |   | |  |  |  |   | || ||/--+++--+-+---+-++--++-++++-++-++-++------++--+-+-+-++----+---+-++--++\\||||||  ||   || |  |     | | |  |  | | \n ||| | |   |/-+---+-+--+--+-\\|   | || |||  |||  | |   | ||  || ||||/++-++-++------++--+-+-+-++----+---+-++--+++++++++--++---++-+--+---\\ | | |  |  | | \n ||| | |   || |   | |  \\--+-++---+-++-+++--+++--+-+---+-++--++-+++++++-++-++------++--+-+-+-++----+---+-++--++++/||||  ||   || |  |   | | | |  |  | | \n ||| | |   || |   | |     | ||   | || |||/-+++--+-+---+-++--++-+++++++-++-++------++--+-+-+-++----+---+-++--++++-++++--++-\\ || |  |   | | | |  |  | | \n ||| | |   || |   | |     | ||   | || |||| |||  | |   | ||  || ||||||| || ||      ||  | | | ||    |   | ||  |||| ||||  || | || |  |   | | | |  |  | | \n ||| |/+---++-+---+-+----\\| ||   | || |||| |||  | |  /+-++--++-+++++++-++-++--\\   ||  | | | ||    \\---+-++--++++-++++--++-+-/| |  |   | | | |  |  | | \n ||| |||   || |   | |    || ||   | || |||| |||  | |  || ||  || ||||||| || ||  |   ||  | | | ||        | ||  |||| ||||  || |  | |  |   | | | |  |  | | \n \\++-+++>--++-+---+-+----++-++---+-++-++++-+++--+-+--++-++--++-+++++++-++-++--+---++--+-+-+-++--------+-+/  |||| ||||  || |  | |  |   | | | |  |  | | \n  || |||   || | /-+-+----++-++---+-++-++++-+++--+-+--++-++-\\|| ||||||| || ||  |   ||  | | | ||        | |   |||| ||||  || |  | |  |   | | | |  |  | | \n  || |||   || | | | |    || ||   | || |||| \\++--+-+--++-++-+++-/|||||| || ||  |   ||  | | | ||        | |   |||| ||||  || |  | |  |   | | | |  |  | | \n  || |||   || |/+-+-+----++-++-\\ | || ||||  ||  | |  || || |||  ||||\\+-++-++--+---++--+-+-+-+/        | |   |||| ||||  || |  | |  |   | | | |  |  | | \n  || |||   || ||| | |    || ||/+-+-++-++++--++--+-+--++-++-+++--++++-+-++-++--+---++--+-+-+-+---------+-+---++++-++++--++-+--+\\|  |   | | | |  |  | | \n  || |||   || ||| | |    || |||| | || ||||  || /+-+--++-++-+++--++++-+-++-++--+---++--+-+-+-+---------+-+---++++-++++--++\\|  \\++--+---+-+-+-+--+--+-/ \n  || |||   || ||| | | /--++-++++\\| || ||||  ||/++-+--++\\|| |||  |||| | || ||  |   ||  | | | |  /------+-+---++++-++++--++++\\  ||  |   | | | |  |  |   \n  || |||   || |||/+-+-+--++-++++++-++-++++--+++++-+--+++++-+++--++++-+-++-++--+---++--+\\| | |  |      | |   |||| ||||  |||||/-++--+---+-+-+-+\\ |  |   \n  |\\-+++---++-+++++-+-+--++-++++++-++-++++--+++++-+--+++++-+++--++++-+-+/ ||  |   ||  ||| | |  |      | |   |||| ||||  |||||| ||  |   | | | || |  |   \n  |  |||   || ||||| | |  || |||||| || ||||  ||||| |  ||||| |\\+--++++-+-+--++--+---++--+++-+-+--+------+-+---++++-++++--++++++-+/  |   | | | || |  |   \n  |  |||   || ||||| | |  || |||||| || ||||  ||||| |  |\\+++-+-+--++++-+-+--++--+---++--+++-+-+--+------+-+---++++-++++--++++++-+---/   | | | || |  |   \n  \\--+++---++-+++++-+-+--++-++++++-++-++++--+++++-+--+-+/| | |  |||| | |  ||  |/--++--+++-+-+--+------+-+---++++-++++--++++++-+--\\    | | | || |  |   \n     |||   || ||||| | |  || |||||| || ||||  ||||| |  | | | | |  |||| | |  ||  || /++--+++-+-+--+--\\   | |   |||| ||||  |||||| |  |    | | | || |  |   \n     |||   || ||||| | |  || |||||| || |||\\--+++++-+--+-+-+-+-+--++++-+-+--++--++-+++--+++-+-+--+--+---+-+---++++-++++--+++/|| |  |    | | | || |  |   \n     |||   || ||||| | |  || ||||||/++-+++---+++++-+--+\\| | | |  |||\\-+-+--++--++-+++--+++-+-+--+--+---+-+---++++-++++--+++-++-+--+----/ | | || |  |   \n     |||  /++-+++++-+-+--++-+++++++++-+++---+++++-+-\\||| | | |  |||  |/+--++--++-+++--+++-+-+--+--+---+-+-\\ |||| ||||  ||| || |  |      | | || |  |   \n    /+++--+++-+++++-+-+--++-+++++++++-+++--\\||||| | |||| | | | /+++--+++--++--++-+++--+++-+-+--+--+---+-+-+-++++-++++--+++-++-+-\\|      \\-+-++-+--/   \n    ||||  ||| ||||| | |  || ||||||||| |||  |||||| | |||| \\-+-+-++++--+++--++--++-+++--+++-+-+--+--+---+-+-+-++++-++++->+++-++-+-++--------+-/| |      \n    ||||  ||| ||||| | |  || ||||||||| |||  |||||| | ||||   | | ||||  |||  ||  || |||  ||| | |/-+--+---+-+-+-++++-++++--+++-++-+-++--------+--+-+--\\   \n    ||||  ||| ||||| | |  || ||||||||| |||  |||||| | ||||   | | |||\\--+++--++--++-+++--+++-+-++-+--+---/ | | |||| ||||  ||| || | ||        |  | |  |   \n    ||||  ||| ||||| | |  || ||||||||^ |||  |||||| | ||||   |/+-+++---+++--++--++-+++--+++-+-++-+--+-----+-+-++++-++++--+++-++-+-++--------+--+-+--+-\\ \n    ||||  ||| ||||| | |  || ||||||||| |||  |||||| | ||||   ||| |||   |||  ||  || |v| /+++-+-++-+--+-----+-+-++++-++++--+++-++-+-++--\\     |  | |  | | \n    ||||  ||| ||||| | |  ||/+++++++++-+++--++++++\\| ||||   ||| |||   |||  ||  || ||| |||| | || |  |     | | |||| ||||  ||| || | ||  |     |  | |  | | \n    ||||  ||| ||||| | |  |||||||||||| ||| /++++++++-++++---+++-+++---+++--++--++-+++-++++-+-++-+--+-----+-+-++++-++++--+++-++-+-++--+-----+--+-+--+\\| \n    ||||  ||| ||||| | |  |||||||||||| ||| ||||||||| ||||   ||| |||   |||  ||  || ||| |||| | || |  |     | | |||| ||||  ||| || | ||  |     |  | |  ||| \n    ||||  ||| ||||| |/+--++++++++++++-+++-+++++++++-++++-\\/+++-+++---+++--++--++-+++-++++-+-++-+--+-----+-+-++++-++++--+++-++-+>++-\\|     |  | |  ||| \n    ||||  ||| ||||| |||  |\\++++++++++-+++-+++++++++-++++-+++++-+++---+++--++--++-+++-++++-+-++-+--+-----+-+-++++-++++--+/| || | || ||     |  | |  ||| \n    ||||  ||| ||||| ||\\--+-+++++/|||| ||| ||||||||| |||| ||||| |||   |||  ||  || ||| |||| | || |  |     | | |||| ||\\+--+-+-++-+-++-++-----/  | |  ||| \n    ||||  ||| ||\\++-++---+-+++++-++++-+++-+++++++++-++++-++/|| |||   |||  ||  || ||| |||| | || |  |     | | |||| || |  | | || | || ||        | |  ||| \n    ||||  ||| || || ||   | ||||| |||\\-+++-+++++++++-++++-++-++-+++---+++--+/  ||/+++-++++-+-++-+--+-----+-+-++++-++-+--+-+-++-+-++-++-\\      | |  ||| \n    ||||  ||| || || ||   | ||||| |||  ||| ||||||||| |||| || || |||   |||  |   |||||| |||| | || |  |     |/+-++++-++-+--+-+-++-+-++-++-+------+-+\\ ||| \n    ||||  ||| || |\\-++---+-+++++-+++--+++-+++++++++-++++-++-++-+++---+++--+---++++++-++++-+-++-+--+-----+++-++++-++-/  | | || | || || |      | || ||| \n /--++++--+++-++-+--++---+-+++++-+++--+++-+++++++++-++++-++-++-+++---+++--+---++++++-++++-+-++-+--+--\\  ||| |||| ||    | | || | || || |      | || ||| \n |  ||||/-+++-++-+--++---+-+++++-+++--+++-+++++++++-++++-++-++-+++---+++--+--\\|||||| \\+++-+-++-+--+--+--+++-++++-++----+-+-++-+-++-+/ |      | || ||| \n |  ||||| ||| || |  ||   | ||||| |||  ||| ||||||||| |||| || || |||   |||  |  |||||||  ||\\-+-++-+--+--+--+++-+/|| ||    | | || | || |  |      | || ||| \n |  |\\+++-+++-++-+--++---+-+++++-+++--+++-++++++/|| |||| || |\\-+++---+++--+--+++++++--++--+-++-+--+--+--+++-+-+/ ||    | | || | || |  |      | || ||| \n |  | ||| ||| || |  ||   | ||||| |||  ||| ||\\+++-++-++++-++-+--+++---/||  |  |||||||  ||  | || |  |  |  ||| | |  ||    | | || | || |  |      | || ||| \n |/-+-+++-+++-++-+--++---+-+++++\\|||  ||| \\+-+++-++-++++-++-+--+++----++--+--+++++++--++--+-++-+--+--+--+++-+-+--++----+-+-++-+-++-+->+------+-++-+/| \n || | ||| ||| || |  ||   | |||||||||  |||  | ||| || |||| || |  ||\\----++--+--+++++++--++--+-++-+--+--+--/|| | |  ||    | | || | || |  |      | || | | \n || | |||/+++-++-+--++---+-+++++++++--+++--+-+++-++-++++-++-+--++-\\   ||  |  |||||||  ||  | || |  |  |   || | |  ||    | | || | || |  |      | || | | \n || | ||||||| || |  ||   | ||||||||| /+++--+-+++-++-++++-++-+--++-+---++--+--+++++++--++--+-++-+--+--+---++-+-+--++----+-+-++-+-++-+\\ |      | || | | \n || | ||||||| || |  ||   | ||||||||| ||||  | ||| || |||| || |  || |   ||  |  |||^|||  ||  | || |  |  |   || | |  ||    | | || | || || |      | || | | \n || | ||||||| || |  |\\---+-+++++++++-++++--+-+++-++-++++-/| |  || |  /++--+--+++++++--++--+-++-+\\ |  |   || | |  ||    | | || | || || |      | || | | \n || | ||||||| |\\-+--+----+-++++/|||| ||||  | ||| || ||||  \\-+--++-+--+++--+--+++++++--++--+-++-++-+--+---++-+-+--++----+-+-++-+-++-/| |      | || | | \n || | ||||||| |  |  |   /+-++++-++++-++++--+-+++-++-++++----+--++-+--+++--+--+++++++--++--+-++-++-+--+---++-+-+--++----+-+-++-+-++\\ | |      | || | | \n || | ||||||| |  |  |   || |||| |||| ||||  | ||| || ||||    |  || |  |||  |  |||||||  ||  | || || |  |   ||/+-+--++----+-+-++-+-+++-+-+--\\   | || | | \n || | ||||||| |  \\--+---++-++++-++++-++++--+-+++-++-++++----+--++-+--+++--+--+++++++--+/  | || || |  |   |||| |  ||    | |/++-+-+++-+-+--+--\\| || | | \n || | ||||||| |     |   || |||| |||| ||||  | ||| || ||||    \\--++-+--+++--+--+++++++--+---+-++-++-+--+---++++-+--++----+-++++-+-+++-+-+--+--++-++-+-/ \n |\\-+-+++++++-+-----+---++-++++-/||| ||||  | ||| || ||||       ||/+--+++--+\\ |||||||  |   | || || |  |   |||| |  ||    | |||| | ||| | |  |  || || |   \n |  | ||||||| |     |   || ||\\+--+++-++++--+-/|\\-++-++++-------++++--+++--++-+++++++--+---+-++-++-+--+---++++-+--++----+-/||| | ||| | |  |  || || |   \n |  | ||\\++++-+-----+---++-++-+--+++-++++--+--+--++-++++-------++++--+++--++-/||||\\+--+---+-++-++-+--+---++++-+--+/    |  ||| | ||| | |  |  || || |   \n |  | || |||| \\-----+---++-++-+--+++-++++--+--+--++-++++-------++++--+++--++--++++-+--+---+-++-++-+--+---++++-+--/     |  ||| | ||| | |  |  || || |   \n |  | || ||||       |   || || |  ||| ||||/-+--+--++-++++-------++++--+++--++--++++-+--+---+-++-++-+--+---++++-+--------+\\ ||| | ||| | |  |  || || |   \n |  | || ||||       |   || || |  ||| ||||| |  |  || ||||/------++++--+++--++--++++-+--+--\\| || || |  |   |||| |        || ||| | ||| | |  |  || || |   \n |  | || ||||       |   || || |  ||| ||||| |  |  || |||||      ||||  |||  ||/-++++-+-<+--++-++-++-+--+---++++-+--------++-+++-+\\||| | |  |  || || |   \n |  | || ||||       |   || || |  ||| ||||| |/-+--++-+++++------++++--+++--+++-++++-+--+--++-++-++-+--+---++++-+--------++-+++-+++++-+-+\\ |  || || |   \n |  | || ||||       |  /++-++-+--+++-+++++-++-+-\\|| |||||      ||||  ||\\--+++-++++-+--+--+/ || || |  |   |||| |        || ||| ||||| | || |  || || |   \n |  | || ||||       |  ||| || |/-+++-+++++-++-+-+++-+++++------++++--++---+++-++++-+--+--+--++-++-+--+---++++-+-------\\|| ||| ||||| | || |  || || |   \n |  | || ||||       |  ||| || || ||| ||||| || | ||| |||||      ||||  ||   ||| |||| |  |  |  || || |  |   |||| |       ||| ||| ||||| | || |  || || |   \n |  | || ||||       |  ||| || || ||| ||||| || | ||| |||||      ||||  ||   ||| |||| |  |  |  || || |  |   ||\\+-+-------+++-+++-+++++-+-++-/  || || |   \n |  | || ||||       |  ||| || || ||| ||||| || | ||| |||||     /++++--++\\  ||| |||| |  |  |  || || |  |   || | |       ||| ||| ||||| | ||    || || |   \n |  | || \\+++-------+--+++-++-++-+++-+++++-++-+-+++-+++++-----++++/  |||  ||| |||| |  |  |  || || |  |   || | |       ||| ||| ||||| | ||    || || |   \n |  | ||  |||       |  ||| || || |\\+-+++++-++-+-+++-++/||     ||||   |||  ||| |||| |  |  |  || || |  |   || | |       ||| ||| ||||| | ||    || || |   \n |  | ||  |||       |  ||| || || | | |||\\+-++-+-+++-++-++-----++++---+++--+++-++++-+--+--+--++-++-+--+---++-+-/       ||| ||| ||||| | ||    || || |   \n |  | ||  |||       |  ||| || || | | ||\\-+-++-+-++/ || ||     ||||   |||  ||| |||| |  |  |  || || |  |   || |    /----+++-+++-+++++-+-++----++-++\\|   \n |  | ||  |||       |  \\++-++-++-+-+-++--+-++-+-/|  || ||     ||||   |||  ||| |||| |  |  |  || || |  |   || |    |    ||| ||| ||||| | ||    || ||||   \n |  | ||  |||       \\---++-++-++-/ | ||  | || \\--+--++-/|     ||||   |||  ||\\-++++-+--+--+--++-++-+--+---++-+----+----+++-+++-+/||^ | ||    || ||||   \n |  | ||/-+++----------\\|| || ||   | ||  | ||    |  ||  |     ||||   |||  ||  |||| |  |  |  || || |  |   || |    |    ||| ||| |/+++-+-++----++-++++\\  \n |  | |\\+-+++----------+++-++-++---+-++--+-++----+--++--+-----++++---+++--++--++++-+--+--+--/|/++-+--+---++-+----+--\\ ||| ||| ||||| | ||    || |||||  \n |  | | | |||          ||| || ||   | ||  | ||    |  ||  |     ||||   |||  ||  |||| |  |  |   |||| |  |   || |    |  | ||| ||| ||||| | ||    || |||||  \n |  | | | |||          ||| \\+-++---+-++--+-++----/  ||  |     ||||   |||  ||  |||| |  |  |   |||| |  |   || |    |  | ||| ||| ||||| | ||    || |||||  \n |  | | | |||          |||  | ||   | ||  | ||       ||  |     ||||   |||/-++--++++-+--+--+---++++-+--+\\  || |    |  | ||| ||| ||||| | ||    || |||||  \n |  | | | |||          |||  | ||   | ||  | ||       ||  |     ||||   |||| ||  |||| |  |  |   \\+++-+--++--++-+----+--+-+++-+++-+++++-+-++----++-+++/|  \n |  | | | |||          |||  | ||   | ||  | ||       ||  |     ||||   |||| ||  |||| |  |  |    ||| |  ||  || |    |  | ||| ||| ||||| | ||    || ||| |  \n |  | | | ||v          |||  | ||   | ||  | ||       ||  |     ||||   |||| ||  |||| |  |  |    ||| |  ||  || |    |  | ||| ||| ||||| | ||    || ||| |  \n |  | | | |||          |||  | \\+---+-++--+-++-------++--+-----++++---++++-++--++++-+--+--+----+++-+--++--++-+----+--+-+++-+++-/|||| | ||    || ||| |  \n/+--+-+-+-+++---\\      |||  |  |   \\-++--+-++-------++--+-----++/|   |||| \\+--++++-+--/  |    |\\+-+--++--++-+----+--+-+++-+/|  |||| | ||    || ||| |  \n||  | | | |||   |      |||  |  |     ||  | ||     /-++--+-----++-+---++++--+--++++-+-----+----+-+-+--++--++-+----+--+-+++\\| |  |||| | ||    || ||| |  \n|\\--+-+-+-+++---+------+++--+--+-----++--+-++-----+-++--+-----++-+---++++--+--++++-+-----+----+-+-+--/|  || |    |  | ||||| |  \\+++-+-++----++-+++-/  \n|   | | | |||   |      |||  |  |     ||  | ||     | ||  |     || |   ||||  |  |||| |     |    \\-+-+---+--++-+----+--/ ||||| |   ||| | ||    || |||    \n|   | | | |||   |      |||  |  \\-----++--+-++-----+-++--+-----++-+---++++--+--++++-+-----+------+-+---+--++-+----+----/|||| |   ||| | ||    || |||    \n|   | | | |||   |      |\\+--+--------++--+-++-----+-++--+-----++-+---++++--+--++++-+-----+---->-+-+---+--++-+----+-----++++-+---++/ | ||    || |||    \n|   | | | ||\\---+------+-+--/        ||  | ||     | ||  |     || |   \\+++--+--++++-+-----+------/ |   |  || |    |     |||| |   ||  | ||    || |||    \n|   | | | ||    |      | |           ||  | ||     | ||  |     || |    \\++--+--++++-+-----+--------+---+--+//+----+-----++++-+---++--+-++--\\ || |||    \n|   | | | ||    |      | |           |\\--+-++-----+-++--+-----++-+-----++--+--++++-+-----+--------+---+--+-+/    |     |||\\-+---++--+-++--+-/| |||    \n|   | v | ||    |      | |           \\---+-++-----+-++--+-----++-+-----++--+--++++-+-----+--------+---+--+-+-----+-----+++--+---++--/ ||  |  | |||    \n|   | | \\-++----+------/ |               | ||     | ||  |     || |     ||  |  |||| |     |        |   |  \\-+-----+-----+++--+---++----++--+--+-+/|    \n|   | |   ||    |        |               | ||     \\-++--+-----++<+-----++--+--++++-+-----+--------+---+----+-----+-----++/  |   ||    ||  |  | | |    \n|   | |   ||    |        |               | ||       ||  \\-----++-+-----++--+--++++-+-----/        |   |    |     \\-----++---+---++----++--+--+-+-/    \n|   | |   |\\----+--------+---------------+-++-------++--------++-+-----++--+--++++-+--------------+---+----+-----------/|   |   ||    ||  |  | |      \n|   | |   |     |  /-----+------\\        | ||       ||        || |     ||  |  |||\\-+--------------/   |    |            |   \\---++----++--+--/ |      \n|   | \\---+-----+--+-----/      |        | ||       ||        || |     ||  |  |||  |                  |    |            |       ||    ||  |    |      \n|   |     |     |  |            |        | ||       ||        \\+-+-----/|  |  |\\+--+------------------+----+------------+-------+/    ||  |    |      \n|   |     |     |  |            |        | ||       ||         | |      |  |  | \\--+------------------+----+------------+-------+-----/|  |    |      \n\\---+-----+-----/  |            |        \\-++-------++---------+-+------+--+--+----+------------------+----+------------/       |      |  |    |      \n    |     |        |            |          |\\-------++---------+-+------+--+--+----+------------------+----+--------------------+------/  |    |      \n    |     |        |            |          |        ||         | \\------+--/  |    \\------------------+----+--------------------+---------+----/      \n    |     \\--------+------------+----------+--------/|         |        |     |                       |    \\--------------------+---------/           \n    \\--------------+------------+----------/         |         |        \\-----+-----------------------/                         |                     \n                   |            |                    |         |              |                                                 |                     \n                   |            |                    \\---------+--------------/                                                 |                     \n                   \\------------/                              \\----------------------------------------------------------------/                     \n                                                                                                                                                      \n")
(def test-input "/->-\\        \n|   |  /----\\\n| /-+--+-\\  |\n| | |  | v  |\n\\-+-/  \\-+--/\n  \\------/   ")
(println test-input)

(def slash-heading {:north :east
                    :east  :north
                    :south :west
                    :west  :south})
(def backslash-heading {:north :west
                        :west  :north
                        :south :east
                        :east  :south})

(defn slash [cart]
  (update cart :heading slash-heading))

(defn backslash [cart]
  (update cart :heading backslash-heading))

(defn straight [cart] cart)

(def left-turn {:north :west
                :west  :south
                :south :east
                :east  :north})

(def right-turn (set/map-invert left-turn))

(def straight-turn identity)

(def next-turn {left-turn straight-turn
                straight-turn right-turn
                right-turn left-turn})

(defn intersection [{:keys [pending-turn] :as cart}]
  (-> cart
      (update :heading pending-turn)
      (update :pending-turn next-turn)))

(defn cart-at [loc heading]
  {:loc          loc
   :heading      heading
   :pending-turn left-turn})

(def head {:north (fn [[x y]] [x (dec y)])
           :west  (fn [[x y]] [(dec x) y])
           :south (fn [[x y]] [x (inc y)])
           :east  (fn [[x y]] [(inc x) y])})

(defn move-one [{:keys [heading] :as cart}]
  (update cart :loc #((head heading) %)))

(defn step-cart [{:keys [loc] :as cart} track-turns]
  (->> cart
       (track-turns loc)
       move-one))

(def parse-track-node {\/ slash
                       \\ backslash
                       \| straight
                       \- straight
                       \+ intersection
                       \> straight
                       \< straight
                       \v straight
                       \^ straight})

(def parse-cart-heading {\^ :north
                         \<    :west
                         \v    :south
                         \>    :east})

(defn parse-cart [x y track-char]
  (when-let [heading (parse-cart-heading track-char)]
    (cart-at [x y] heading)))

(defn track-node [y x track-piece]
  [[x y] (parse-track-node track-piece)])

(defn location-comparator [cart1 cart2]
  ; Break ties with whole value.
  (compare [(:loc cart1) cart1]
           [(:loc cart2) cart2]))

(let [input-lines (str/split-lines test-input)
      track (->> input-lines
                 (map-indexed
                   (fn [y line]
                     (map-indexed
                       (fn [x track-char]
                         [[x y]
                          (parse-track-node track-char)])
                       line)))
                 (apply concat)
                 (filter #(nth % 1))
                 (into (sorted-map)))
      carts (->> input-lines
                 (map-indexed
                   (fn [y line]
                     (map-indexed
                       (fn [x track-char]
                         (when-let [heading (parse-cart-heading track-char)]
                           (cart-at [x y] heading)))
                       line)))
                 (apply concat)
                 (filter identity)
                 (into (sorted-set-by location-comparator)))]
  [track carts])

(defn solve-1 [])


(defn solve-2 [])
;; TODO


;(deftest part-1
;  (is (= (str answer-1)
;         (str (solve-1)))))
;
;(deftest part-2
;  (is (= (str answer-2)
;         (str (solve-2)))))

;;;; Scratch

(comment
  (t/run-tests))

